<nav class="navbar navbar-expand-md navbar-light d-md-none py-2">
  <div class="container-fluid flex-column align-items-stretch p-0">
    <div class="d-flex w-100 align-items-center justify-content-between px-2">
      <button
        class="navbar-toggler ms-0"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#sidebarOffcanvas"
        aria-controls="sidebarOffcanvas"
        aria-label="Open navigation menu"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div
        class="flex-grow-1 d-flex flex-column align-items-center justify-content-center"
      >
        <a
          class="navbar-brand fs-4 fw-bold d-flex align-items-center justify-content-center mb-0"
          href="#"
        >
          <i class="fas fa-cubes me-2"></i> HR ERP
        </a>
        <div
          *ngIf="isLoggedIn$ | async"
          class="text-center small text-white fw-bold w-100 mt-1"
        >
          Welcome, {{ username }}!
        </div>
        <span class="role-badge mt-1">{{ role$ | async }}</span>
      </div>
      <div style="width: 40px"></div>
      <!-- Spacer to balance toggler -->
    </div>
  </div>
</nav>

<div class="d-flex min-vh-100">
  <!-- Sidebar Navigation (only if logged in) -->
  <ng-container *ngIf="isLoggedIn$ | async">
    <!-- Offcanvas Sidebar for mobile -->
    <div
      class="offcanvas offcanvas-start d-md-none"
      tabindex="-1"
      id="sidebarOffcanvas"
      aria-labelledby="sidebarOffcanvasLabel"
    >
      <div class="offcanvas-header bg-primary text-white">
        <h5
          class="offcanvas-title mb-0 d-flex align-items-center"
          id="sidebarOffcanvasLabel"
        >
          <i class="fas fa-cubes me-2"></i> HR ERP
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body p-0 bg-light" style="min-height: 100vh">
        <ul class="nav flex-column w-100 pt-3">
          <!-- Admin -->
          <ng-container *ngIf="(role$ | async) === 'Admin'">
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/payroll"
                routerLinkActive="active"
              >
                <i class="fas fa-money-check-alt me-2"></i> Payroll
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/employee"
                routerLinkActive="active"
              >
                <i class="fas fa-users me-2"></i> Employees
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/leave"
                routerLinkActive="active"
              >
                <i class="fas fa-calendar-alt me-2"></i> Leave
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/leave-approve"
                routerLinkActive="active"
              >
                <i class="fas fa-calendar-check me-2"></i> Leave Approve
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/profile"
                routerLinkActive="active"
              >
                <i class="fas fa-user-circle me-2"></i> Profile
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/tasks"
                routerLinkActive="active"
              >
                <i class="fas fa-clipboard-list me-2"></i> Tasks
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/learning"
                routerLinkActive="active"
              >
                <i class="fas fa-graduation-cap me-2"></i> Learning
              </a>
            </li>
          </ng-container>
          <!-- HR -->
          <ng-container *ngIf="(role$ | async) === 'HR'">
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/employee"
                routerLinkActive="active"
              >
                <i class="fas fa-users me-2"></i> Employees
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/leave-approve"
                routerLinkActive="active"
              >
                <i class="fas fa-calendar-check me-2"></i> Leave Approve
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/tasks"
                routerLinkActive="active"
              >
                <i class="fas fa-clipboard-list me-2"></i> Tasks
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/learning"
                routerLinkActive="active"
              >
                <i class="fas fa-graduation-cap me-2"></i> Learning
              </a>
            </li>
          </ng-container>
          <!-- Employee -->
          <ng-container *ngIf="(role$ | async) === 'Employee'">
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/profile"
                routerLinkActive="active"
              >
                <i class="fas fa-user-circle me-2"></i> Profile
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/leave"
                routerLinkActive="active"
              >
                <i class="fas fa-calendar-alt me-2"></i> Leave
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/tasks"
                routerLinkActive="active"
              >
                <i class="fas fa-clipboard-list me-2"></i> Tasks
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/learning"
                routerLinkActive="active"
              >
                <i class="fas fa-graduation-cap me-2"></i> Learning
              </a>
            </li>
          </ng-container>
          <!-- Project Manager -->
          <ng-container *ngIf="(role$ | async) === 'ProjectManager'">
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/employee"
                routerLinkActive="active"
              >
                <i class="fas fa-users me-2"></i> Employees
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/tasks"
                routerLinkActive="active"
              >
                <i class="fas fa-clipboard-list me-2"></i> Tasks
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                class="nav-link d-flex align-items-center"
                routerLink="/learning"
                routerLinkActive="active"
              >
                <i class="fas fa-graduation-cap me-2"></i> Learning
              </a>
            </li>
          </ng-container>
          <li class="nav-item mt-3 px-3">
            <button class="btn btn-outline-danger w-100" (click)="logout()">
              <i class="fas fa-sign-out-alt me-2"></i> Logout
            </button>
          </li>
        </ul>
      </div>
    </div>
    <!-- Desktop Sidebar -->
    <nav
      class="sidebar d-none d-md-flex flex-column align-items-center py-4 px-2"
    >
      <div
        class="mb-4 w-100 d-flex flex-column align-items-center justify-content-center"
      >
        <a class="navbar-brand fs-4 fw-bold d-flex align-items-center" href="#">
          <i class="fas fa-cubes me-2"></i> HR ERP
        </a>
        <div
          *ngIf="isLoggedIn$ | async"
          class="text-center small text-white fw-bold w-100 mt-2"
        >
          Welcome, {{ username }}!
        </div>
      </div>
      <span class="role-badge mb-3">{{ role$ | async }}</span>
      <ul class="nav flex-column w-100">
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'Admin'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/payroll"
            routerLinkActive="active"
          >
            <i class="fas fa-money-check-alt me-2"></i> Payroll
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'Admin'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/employee"
            routerLinkActive="active"
          >
            <i class="fas fa-users me-2"></i> Employees
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'Admin'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-alt me-2"></i> Leave
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'Admin'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave-approve"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-check me-2"></i> Leave Approve
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'HR'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/employee"
            routerLinkActive="active"
          >
            <i class="fas fa-users me-2"></i> Employees
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'HR'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-alt me-2"></i> Leave
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'HR'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave-approve"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-check me-2"></i> Leave Approve
          </a>
        </li>
        <!-- Leave link for Employee only (desktop) -->
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'Employee'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-alt me-2"></i> Leave
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'ProjectManager'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/employee"
            routerLinkActive="active"
          >
            <i class="fas fa-users me-2"></i> Employees
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'ProjectManager'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/tasks"
            routerLinkActive="active"
          >
            <i class="fas fa-clipboard-list me-2"></i> Tasks
          </a>
        </li>
        <li class="nav-item mb-2" *ngIf="(role$ | async) === 'ProjectManager'">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/leave"
            routerLinkActive="active"
          >
            <i class="fas fa-calendar-alt me-2"></i> Leave
          </a>
        </li>
        <li
          class="nav-item mb-2"
          *ngIf="
            (role$ | async) === 'Admin' ||
            (role$ | async) === 'HR' ||
            (role$ | async) === 'Employee' ||
            (role$ | async) === 'ProjectManager'
          "
        >
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/tasks"
            routerLinkActive="active"
          >
            <i class="fas fa-clipboard-list me-2"></i> Tasks
          </a>
        </li>
        <li
          class="nav-item mb-2"
          *ngIf="
            (role$ | async) === 'Admin' ||
            (role$ | async) === 'HR' ||
            (role$ | async) === 'Employee' ||
            (role$ | async) === 'ProjectManager'
          "
        >
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/learning"
            routerLinkActive="active"
          >
            <i class="fas fa-graduation-cap me-2"></i> Learning
          </a>
        </li>
        <li class="nav-item mb-2">
          <a
            class="nav-link d-flex align-items-center"
            routerLink="/profile"
            routerLinkActive="active"
          >
            <i class="fas fa-user-circle me-2"></i> Profile
          </a>
        </li>
        <li class="nav-item mt-3 px-3">
          <button class="btn btn-outline-light w-100" (click)="logout()">
            <i class="fas fa-sign-out-alt me-2"></i> Logout
          </button>
        </li>
      </ul>
    </nav>
  </ng-container>

  <!-- Main Content -->
  <div class="flex-grow-1 d-flex flex-column" style="min-width: 0">
    <main class="flex-grow-1 p-3">
      <router-outlet></router-outlet>
    </main>
    <app-notification></app-notification>
  </div>
</div>
